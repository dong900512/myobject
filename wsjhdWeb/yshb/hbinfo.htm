<!doctype html>
<html>
<head>
    <title>红包获取信息</title>
</head>
<script src="http://ossweb-img.qq.com/images/js/jquery/jquery-1.7.2.min.js" type="text/javascript"></script>
<!--Reference the SignalR library. -->
<script src="/Scripts/jquery.signalR-1.0.1.min.js" type="text/javascript"></script>
<!--Reference the autogenerated SignalR hub script. -->
<!--Add script to update the page and send messages.-->
<script src="/signalr/hubs"></script>
<style>
    #shower div { float: left; margin: 5px 12px; width: 127px; }
</style>
<body>
    <div id="shower">
    </div>
    <script type="text/javascript">
        $(function () {
            var hub = $.connection.buyer;
            function init() {
                return hub.server.getNeastBuyerInfo().done(function (buyers) {
                    //从BuyerHub获取buyer数组，就是这里的参数
                    //遍历显示，如果现在列表中不包含，则插入到第一条
                    var div = $("#shower");
                    $.each(buyers, function (index, item) {
                        if ($("div[data-nick='" + item.Id + "']", div).length) return; //列表中已经存在则漂过
                        var x = $("<div>").attr("data-nick", item.Id).html(
                    "<span style='display:inline-block;width:127px'><img src='" + item.Extent2 + "' style='width:100%;height:100%; border-radius: 300px;'/></span>   <span style='display: inherit;width: 127px; text-align: center;color:red;' class='label label-success'>" +
                        item.Remark + "</span><span style='display: inherit;width: 127px; text-align: center; color:red;'>4 元</span>");
                        div.prepend(x);
                    });
                });
            }
            $.extend(hub.client, {
                updateInfo: function () {//为client创建一个方法updateInfo一会会用到
                    return init();
                }
            });
            $.connection.hub.start().pipe(init); //开启客户端SignalR，并首次运行init
        });
    </script>
</body>
</html>
