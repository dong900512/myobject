<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>联想科技城-众筹</title>
    <meta name="description" content="联想科技城-众筹" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-touch-fullscreen" content="yes">
    <!-- 是否启用 WebApp 全屏模式，删除苹果默认的工具栏和菜单栏 -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- 设置苹果工具栏颜色 -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <!-- 忽略页面中的数字识别为电话，忽略email识别 -->
    <meta name="format-detection" content="telphone=no, email=no" />
    <!-- 启用360浏览器的极速模式(webkit) -->
    <meta name="renderer" content="webkit">
    <!--优先使用 IE 最新版本和 Chrome-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <!--百度禁止转码-->
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <!-- 针对手持设备优化，主要是针对一些老的不识别viewport的浏览器，比如黑莓 -->
    <meta name="HandheldFriendly" content="true">
    <!-- 微软的老式浏览器 -->
    <meta name="MobileOptimized" content="320">
    <!-- uc强制竖屏 -->
    <meta name="screen-orientation" content="portrait">
    <!-- QQ强制竖屏 -->
    <meta name="x5-orientation" content="portrait">
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- UC应用模式 -->
    <meta name="browsermode" content="application">
    <!-- QQ应用模式 -->
    <meta name="x5-page-mode" content="app">
    <!-- windows phone 点击无高光 -->
    <meta name="msapplication-tap-highlight" content="no">
    <!--无缓存设置-->
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate" />
    <meta http-equiv="expires" content="Wed, 26 Feb 1997 08:21:57 GMT" />
    <link href="css/animate.min.css" rel="stylesheet" type="text/css" />
    <link href="css/loading.css" rel="stylesheet" type="text/css" />
    <link href="css/index.css" rel="stylesheet" type="text/css" />
    <link href="js/global.css" rel="stylesheet" type="text/css" />
    <link href="js/zepto.fullpage.css" rel="stylesheet" type="text/css" />
    <script>
        if (navigator.userAgent.toLowerCase().match(/MicroMessenger/i) != 'micromessenger') {
            //window.location.href="/index.html";
        }
    </script>
    <style>
        
    </style>
</head>
<body>
    <div class="spinner">
        <div class="rect1">
        </div>
        <div class="rect2">
        </div>
        <div class="rect3">
        </div>
        <div class="rect4">
        </div>
        <div class="rect5">
        </div>
    </div>
    <header class="app-header">
        <a href="javascript:void(0);" class="u-globalAudio z-play">
            <audio loop="" src="" id="ttnb" autoplay="" preload type="audio/mpeg">
            </audio>
        </a>
    </header>
    <div class="main">
        <div class="wp">
            <div class="wp-inner">
                <div class="page pg1">
                    <div id="pg1_1">
                    </div>
                    <div id="pg1_2">
                    </div>
                    <div id="pg1_3">
                    </div>
                </div>
                <div class="page pg2">
                    <div id="pg2_1">
                    </div>
                    <div id="pg2_2">
                    </div>
                    <div id="pg2_3">
                    </div>
                    <div id="pg2_4">
                    </div>
                    <div id="pg2_5">
                    </div>
                    <div id="pg2_6">
                    </div>
                    <div id="pg2_7">
                    </div>
                    <div id="pg2_8">
                    </div>
                    <div id="pg2_9">
                    </div>
                    <div id="pg2_10">
                    </div>
                    <div id="pg2_11">
                    </div>
                </div>
                <div class="page pg3">
                    <div id="pg3_1">
                    </div>
                    <div id="pg3_2">
                    </div>
                    <div id="pg3_3">
                    </div>
                    <div id="pg3_4">
                    </div>
                    <div id="pg3_5">
                    </div>
                    <div id="pg3_6">
                    </div>
                    <div id="pg3_7">
                    </div>
                    <div id="pg3_8">
                    </div>
                    <div id="pg3_9">
                    </div>
                    <div id="pg3_10">
                    </div>
                </div>
                <div class="page pg4">
                    <div id="pg4_1">
                    </div>
                    <div id="pg4_2">
                    </div>
                    <div id="pg4_3">
                    </div>
                    <div id="pg4_4">
                    </div>
                    <div id="pg4_5">
                    </div>
                    <div id="pg4_6">
                    </div>
                </div>
                <div class="page pg5">
                    <div id="pg5_1">
                    </div>
                    <div id="pg5_2">
                    </div>
                    <div id="pg5_3">
                    </div>
                    <div id="pg5_4">
                    </div>
                    <div id="pg5_5">
                    </div>
                </div>
                <div class="page pg6">
                    <div id="pg6_1">
                    </div>
                    <div id="pg6_2">
                    </div>
                    <div id="pg6_3">
                    </div>
                    <div id="pg6_4">
                    </div>
                    <button id="gz">
                    </button>
                    <button id="cj">
                    </button>
                </div>
            </div>
        </div>
        <img class="arrows-up ani infinite" src="img/arrow-up.png" style="width: 40px!important;
            height: 30px!important;" />
    </div>
    <div class="box1">
        <div class="box1_1">
            <div class="box1_2">
                <div class="box1_info">
                    <img src="img/close.png" class="closeinfo" style="right: 57px; float: right; margin-top: 5px;
                        margin-right: 5%;" />
                    <div style="clear: both;">
                    </div>
                    <div style="width: 90%; margin-left: 5%; height: 279px; background-color: #f8b72c;
                        border-radius: 8%; background-size: 100% 100%; text-align: center;">
                        <img src="img/topline.png" style="width: 100%;" />
                        <table>
                            <tr>
                                <td>
                                    姓名
                                </td>
                                <td>
                                    <input class="tname" onkeyup="value=value.replace(/[^\a-\z\A-\Z0-9\u4E00-\u9FA5\ ]/g,'')"
                                        onpaste="value=value.replace(/[^\a-\z\A-\Z0-9\u4E00-\u9FA5\ ]/g,'')" oncontextmenu="value=value.replace(/[^\a-\z\A-\Z0-9\u4E00-\u9FA5\ ]/g,'')" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    电话
                                </td>
                                <td>
                                    <input type="tel" class="tphone" maxlength="11" onkeypress='return /^\d$/.test(String.fromCharCode(event.keyCode))'
                                        oninput='this.value = this.value.replace(/\D+/g, "")' onpropertychange='if(!/\D+/.test(this.value)){return;};this.value=this.value.replace(/\D+/g, "")'
                                        onblur='this.value = this.value.replace(/\D+/g, "")' />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    份额
                                </td>
                                <td>
                                    <button class="jian">
                                    </button>
                                    <input type="tel" readonly class="tfnum" value="1" onkeypress='return /^\d$/.test(String.fromCharCode(event.keyCode))'
                                        oninput='this.value = this.value.replace(/\D+/g, "")' onpropertychange='if(!/\D+/.test(this.value)){return;};this.value=this.value.replace(/\D+/g, "")'
                                        onblur='this.value = this.value.replace(/\D+/g, "")' />
                                    <button class="jia">
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    总金额
                                </td>
                                <td>
                                    <input value="12.00" type="text" readonly style="text-align: center;" class="total" />
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <button class="btnsure">
                                        提交支付</button>
                                </td>
                            </tr>
                        </table>
                        <img src="img/botline.png" style="width: 100%;" />
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="sec2">
        <img src="img/gz.png" style="position: absolute;" />
        <button class="btnreturn">
        </button>
    </div>
    <input type="hidden" id="jg" value="12" />
    <script src="http://ossweb-img.qq.com/images/js/zepto/zepto.min.js"></script>
    <script src="http://ossweb-img.qq.com/images/js/motion/loader.min.js"></script>
    <script src="http://ossweb-img.qq.com/images/js/motion/dialog.min.js"></script>
    <script src="http://ossweb-img.qq.com/images/js/motion/overlay.min.js"></script>
    <script src="http://ossweb-img.qq.com/images/js/motion/landscape.min.js"></script>
    <script src="js/zepto.fullpage.js" type="text/javascript"></script>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script src="/js/share.js" type="text/javascript"></script>
    <script type="text/javascript">
        dataForWeixin.img = "http://wsjhb.tencenthouse.com/Tepay/img/fxs.jpg";
        dataForWeixin.url = "http://wsjhb.tencenthouse.com/Tepay/zclxInfo.aspx";
        dataForWeixin.desc = "众筹通道";
        dataForWeixin.title = "众筹通道";
        var vh = $(window).height();
        var vw = $(window).width();
        var Landscape = new mo.Landscape({});
        var sourceArr = ['img/1.mp3','img/1.jpg', 'img/2.jpg', 'img/4.jpg', 'img/5.jpg', 'img/6.jpg', 'img/1.1.png', 'img/1.2.png', 'img/1.3.png', 'img/1.4.png', 'img/2.1.png', 'img/2.10.png', 'img/2.11.png', 'img/2.2.png', 'img/2.3.png', 'img/2.4.png', 'img/2.5.png', 'img/2.6.png', 'img/2.7.png', 'img/2.8.png', 'img/2.9.png', 'img/3.1.png', 'img/3.2.png', 'img/3.3.png', 'img/3.4.png', 'img/3.5.png', 'img/3.6.png', 'img/3.8.png', 'img/3.9.png', 'img/3.10.png', 'img/4.1.png', 'img/4.2.png', 'img/4.3.png', 'img/4.4.png', 'img/4.5.png', 'img/4.6.png', 'img/5.1.png', 'img/5.2.png', 'img/5.3.png', 'img/5.4.png', 'img/5.5.png', 'img/6.1.png', 'img/6.2.png', 'img/6.3.png', 'img/6.4.png', 'img/btncj.png', 'img/btngz.png', 'img/btnreturn.png', 'img/gz.png', 'img/topline.png', 'img/botline.png']; //需要加载的资源列表
        new mo.Loader(sourceArr, {
            onLoading: function (count, total) {
                //alert('加载中...（'+count/total*100+'%）');
            },
            onComplete: function (time) {
                var ttnb = document.getElementById("ttnb");
                $(".spinner").fadeOut(100);
                $(".main").fadeIn(100);
                LoadAud(ttnb,'img/1.mp3');
                fdisc();
                $(".box1_info").css("width", vw);
                $(".sec2,.divBg,.swiper-container,.sec2,.box1").css({ "height": vh, width: vw });
                $("#gz").on("touchend", function () {

                    $(".sec2").fadeIn(100);
                });
                $("#cj").on("touchend", function () {

                    $(".box1").fadeIn(100);
                });
                $(".closeinfo").on("touchend", function () {
                    $(".box1").fadeOut(100);

                });
                $(".btnreturn").on("touchend", function () {
                    $(".sec2").fadeOut(100);

                });



                $(".jian").on("touchend", function () {
                    var tmpnum = parseInt($(".tfnum").val());
                    if (tmpnum > 1) {
                        $(".tfnum").val(parseInt($(".tfnum").val()) - 1);
                        $(".total").val(parseInt($(".tfnum").val()) * 12 + ".00");
                        $("#jg").val(parseInt($(".tfnum").val()) * 12);
                    } else {
                        dialog("众筹金额至少需要购买一份！", "alert");
                    }
                });
                $(".jia").on("touchend", function () {
                    var tmpnum = parseInt($(".tfnum").val());

                    if (tmpnum >= 20) {
                        dialog("每人购买的众筹上限是20份", "alert");
                        return false;
                    } else {
                        $(".tfnum").val(parseInt($(".tfnum").val()) + 1);
                        $(".total").val(parseInt($(".tfnum").val()) * 12 + ".00");
                    }
                    $("#jg").val(parseInt($(".tfnum").val()) * 12);
                })
                $(".btnsure").on("touchend", function () {
                    //alert("进入支付");
                    tjinfo();
                });
            }
        });
        function tjinfo() {
            //document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
            wx.ready(function () {
                //alert("进入支付0");
                //alert($("#jg").val());
                var totalprice = parseInt($(".tfnum").val()) * 0.01; // parseInt($("#jg").val());
                //alert(totalprice);
                var tnum = $(".tfnum").val();
                var name = $(".tname").val();
                var phone = $(".tphone").val();

                if (name == "" || name == null) {
                    dialog("请输入姓名信息", "alert");
                    return false;
                }
                if (phone == "" || phone == null) {
                    dialog("请输入手机号码信息", "alert");
                    return false;
                }
                var usernamereg = /^(13|15|18|17)[0-9]{9}$/;
                if (!usernamereg.test(phone)) {
                    dialog("请输入正确的手机号码", "alert");
                    return false;
                }
                $(".btnsure").attr("disabled", "disabled");
                //alert(totalprice+"|"+tnum);
                // return false;
                if ("<%=wxopid %>" == "" || "<%=wxopid %>" == null) {
                    window.location.href = "zclxInfo.aspx";
                } else {
                    window.overlay1 = new mo.Overlay({
                        content: '支付信息请求中...',
                        valign: 'top',
                        offset: [0, 10]
                    });
                    //首先通过ashx获取信息
                    $.ajax({
                        url: "payhelperinfo.ashx?type=AddInfo",
                        type: "post",
                        dataType: "json",
                        data: { "total": totalprice, "tnum": tnum, "name": name, "phone": phone },
                        success: function (result) {
                            overlay1.close();
                            if (result.count == 1) {
                                //alert(result);

                                $.each(result.result, function (i, n) {
                                    var ordid = n.orderid;
                                    //alert("进入支付:"+ordid+",tim:"+n.timeStamp+",non:"+n.nonceStr+",pack:"+n.package+",sign:"+n.paySign);
                                    wx.chooseWXPay({
                                        timestamp: n.timeStamp,
                                        nonceStr: n.nonceStr,
                                        package: n.package,
                                        signType: 'MD5',
                                        paySign: n.paySign,
                                        success: function (res) {
                                            dialog("当前众筹金额已支付成功！", "success");
                                        }, error: function (st) {
                                            //alert(st);
                                        }
                                    });
                                    //alert(res);
                                    //                                    $(".btnsure").attr("disabled", "disabled");
                                    $(".btnsure").removeAttr("disabled");
                                });
                            } else {
                                //alert();
                                dialog(result.code);
                                return false;
                            }
                        },
                        error: function () {
                            alert_t("服务器繁忙，请稍候再试！");
                        }
                    });
                }
                // }, false);
            });
        }
        function fdisc() {
            $(".wp,.page,.page div").css({ "height": $(window).height(), "width": $(window).width() });
            $('.wp-inner').fullpage({
                dir: 'v',
                start: 5,
                change: function (e) {
                    var ti = e.cur;
                    if (ti == 0) {
                        $("#pg1_1").addClass("pg1_1");
                        $("#pg1_2").addClass("pg1_2");
                        $("#pg1_3").addClass("pg1_3");
                    } else {
                        $("#pg1_1").removeClass("pg1_1");
                        $("#pg1_2").removeClass("pg1_2");
                        $("#pg1_3").removeClass("pg1_3");
                    }
                    if (ti == 1) {
                        $("#pg2_1").addClass("pg2_1");
                        $("#pg2_2").addClass("pg2_2");
                        $("#pg2_3").addClass("pg2_3");
                        $("#pg2_4").addClass("pg2_4");
                        $("#pg2_5").addClass("pg2_5");
                        $("#pg2_6").addClass("pg2_6");
                        $("#pg2_7").addClass("pg2_7");
                        $("#pg2_8").addClass("pg2_8");
                        $("#pg2_9").addClass("pg2_9");
                        $("#pg2_10").addClass("pg2_10");
                        $("#pg2_11").addClass("pg2_11");
                    } else {
                        $("#pg2_1").removeClass("pg2_1");
                        $("#pg2_2").removeClass("pg2_2");
                        $("#pg2_3").removeClass("pg2_3");
                        $("#pg2_4").removeClass("pg2_4");
                        $("#pg2_5").removeClass("pg2_5");
                        $("#pg2_6").removeClass("pg2_6");
                        $("#pg2_7").removeClass("pg2_7");
                        $("#pg2_8").removeClass("pg2_8");
                        $("#pg2_9").removeClass("pg2_9");
                        $("#pg2_10").removeClass("pg2_10");
                        $("#pg2_11").removeClass("pg2_11");
                    }
                    if (ti == 2) {
                        $("#pg3_1").addClass("pg3_1");
                        $("#pg3_2").addClass("pg3_2");
                        $("#pg3_3").addClass("pg3_3");
                        $("#pg3_4").addClass("pg3_4");
                        $("#pg3_5").addClass("pg3_5");
                        $("#pg3_6").addClass("pg3_6");
                        $("#pg3_7").addClass("pg3_7");
                        $("#pg3_8").addClass("pg3_8");
                        $("#pg3_9").addClass("pg3_9");
                        $("#pg3_10").addClass("pg3_10");
                    } else {
                        $("#pg3_1").removeClass("pg3_1");
                        $("#pg3_2").removeClass("pg3_2");
                        $("#pg3_3").removeClass("pg3_3");
                        $("#pg3_4").removeClass("pg3_4");
                        $("#pg3_5").removeClass("pg3_5");
                        $("#pg3_6").removeClass("pg3_6");
                        $("#pg3_7").removeClass("pg3_7");
                        $("#pg3_8").removeClass("pg3_8");
                        $("#pg3_9").removeClass("pg3_9");
                        $("#pg3_10").removeClass("pg3_10");
                    }
                    if (ti == 3) {
                        $("#pg4_1").addClass("pg4_1");
                        $("#pg4_2").addClass("pg4_2");
                        $("#pg4_3").addClass("pg4_3");
                        $("#pg4_4").addClass("pg4_4");
                        $("#pg4_5").addClass("pg4_5");
                        $("#pg4_6").addClass("pg4_6");
                    } else {
                        $("#pg4_1").removeClass("pg4_1");
                        $("#pg4_2").removeClass("pg4_2");
                        $("#pg4_3").removeClass("pg4_3");
                        $("#pg4_4").removeClass("pg4_4");
                        $("#pg4_5").removeClass("pg4_5");
                        $("#pg4_6").removeClass("pg4_6");
                    }
                    if (ti == 4) {
                        $("#pg5_1").addClass("pg5_1");
                        $("#pg5_2").addClass("pg5_2");
                        $("#pg5_3").addClass("pg5_3");
                        $("#pg5_4").addClass("pg5_4");
                        $("#pg5_5").addClass("pg5_5");
                    } else {
                        $("#pg5_1").removeClass("pg5_1");
                        $("#pg5_2").removeClass("pg5_2");
                        $("#pg5_3").removeClass("pg5_3");
                        $("#pg5_4").removeClass("pg5_4");
                        $("#pg5_5").removeClass("pg5_5");
                    }
                    if (ti == 5) {
                        $("#pg6_1").addClass("pg6_1");
                        $("#pg6_2").addClass("pg6_2");
                        $("#pg6_3").addClass("pg6_3");
                        $("#pg6_4").addClass("pg6_4");
                        $("#gz").addClass("gz");
                        $("#cj").addClass("cj");
                        $(".arrows-up").fadeOut(100);
                    } else {
                        $("#pg6_1").removeClass("pg6_1");
                        $("#pg6_2").removeClass("pg6_2");
                        $("#pg6_3").removeClass("pg6_3");
                        $("#pg6_4").removeClass("pg6_4");
                        $("#gz").removeClass("gz");
                        $("#cj").removeClass("cj");
                        $(".arrows-up").fadeIn(100);
                    }
                }
            })
        };
        function LoadAud(obj, aud) {
            if (obj != null && obj.canPlayType && obj.canPlayType("audio/mpeg")) {
                obj.pause();
                obj.src = aud;
                try {
                    obj.currentTime = 0;
                    //alert("456")
                    obj.play();

                } catch (e) {
                }
                obj.play();
                document.addEventListener('WeixinJSBridgeReady', function () {
                    obj.play();
                });
                $audio = $("audio");
                if ($audio.length > 0) {
                    $(".u-globalAudio").addClass("play_yinfu");
                    $audio.parent("a").prepend('<i class="icon-music"></i>');
                }
                $(".u-globalAudio").on("click", function () {
                    $(this).toggleClass("z-play");
                    if ($(this).hasClass("z-play")) {
                        $(this).addClass("play_yinfu");
                        obj.play();
                    } else {
                        $(this).removeClass("play_yinfu");

                        obj.pause();
                    }
                });
            }
        }
        function dialog(cont, type) {
            window.dia1 = new mo.Dialog({
                content: cont,
                type: type
            });
        }
    </script>
</body>
</html>
